{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Session #{{ session.id }} – {{ session.client_name or "No client name" }}</h2>
  <p style="font-size:0.9rem;color:#9ca3af;">
    External ID: {{ session.external_id }}<br />
    Status: {{ session.status or "-" }}<br />
    Created: {{ session.created_at.strftime("%Y-%m-%d %H:%M") }}<br />
    Updated: {{ session.updated_at.strftime("%Y-%m-%d %H:%M") }}
  </p>
  {% if session.predicted_price is not none %}
    <p><strong>Predicted Price:</strong>
      ${{ "%.2f"|format(session.predicted_price) }}</p>
  {% endif %}
</div>

<div class="card">
  <h3>Summary</h3>
  <p style="white-space:pre-wrap;">{{ session.summary or "No summary" }}</p>
</div>

<div class="card">
  <h3>Transcript</h3>
  {% if session.transcript %}
    <pre>{{ session.transcript }}</pre>
  {% else %}
    <p>No transcript.</p>
  {% endif %}
</div>

<div class="card">
  <h3>Analysis (raw JSON)</h3>
  {% if session.analysis_json %}
    <pre>{{ session.analysis_json | tojson(indent=2) }}</pre>
  {% else %}
    <p>No analysis JSON.</p>
  {% endif %}
</div>

<div class="card">
  <h3>Uploads</h3>
  {% if session.uploads %}
    <ul>
      {% for u in session.uploads %}
        <li>
          <strong>{{ u.kind or "file" }}</strong> –
          {{ u.filename or "Unnamed" }}
          {% if u.file_url %}
            – <a href="{{ u.file_url }}" target="_blank">open</a>
          {% endif %}
          {% if u.size_bytes %}
            – {{ u.size_bytes }} bytes
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No uploads for this session.</p>
  {% endif %}
</div>

<div class="card">
  <h3>Quote</h3>
  {% if session.quote %}
    <p>
      <strong>Total:</strong>
      {% if session.quote.total_amount is not none %}
        {{ session.quote.currency or "USD" }}
        {{ "%.2f"|format(session.quote.total_amount) }}
      {% else %}
        -
      {% endif %}
    </p>
    {% if session.quote.notes %}
      <p style="white-space:pre-wrap;">{{ session.quote.notes }}</p>
    {% endif %}

    {% if session.quote.line_items %}
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th>Qty</th>
            <th>Unit</th>
            <th>Line Total</th>
          </tr>
        </thead>
        <tbody>
          {% for li in session.quote.line_items %}
            <tr>
              <td>{{ li.description }}</td>
              <td>{{ li.quantity }}</td>
              <td>${{ "%.2f"|format(li.unit_price) }}</td>
              <td>${{ "%.2f"|format(li.line_total) }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No line items.</p>
    {% endif %}
  {% else %}
    <p>No quote attached.</p>
  {% endif %}
</div>
{% endblock %}
